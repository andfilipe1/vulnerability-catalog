/* html.helper.js: 
 * here are some javascript functions to enable html features.
 */


function getURLParameters() {
  // Returns an array = [[param1, value1], [param2, value2],...]
  // presentet at the _current_ URL's query string: ?param1=value1&...
  // No parameteres are required.

  // Getting the current url:
  var url = window.location;

  // Getting the parameters from the query string:
  var params = url.search.substring(1);

  // Ensuring it works even with a single parameter:
  if (params.includes("&")) {
    params = params.split("&");
  } else {
    var tmp = [];
    tmp.push(params);
    params = tmp;
  }
  // Create an array containing the result:
  params = params.map(v => v.split("="));
  return params;
}

function movePage(direction) {
  //direction should be "next" or "previous i.e.:
  //movePage(next) or movePage(previous)

  var allowedParameters = ["next", "previous"];
  var steps = 10; //10 entries per table in the default mode.

  //Ensures that a given 'value' is present at 'testArray':
  function checkParameters(testArray, value) {
    return testArray.some(x => x === value);
  }

  if (!checkParameters(allowedParameters, direction)) {
    console.log("Parameters are 'next' or 'previous'.");
  }

  var params = getURLParameters();

  // Checking to get our values. 
  for (var i in params) {
    if (params[i][0] == "start") {
      var start = params[i][1];
    }
    if (params[i][0] == "stop") {
      var stop = params[i][1];
    }
  }
  // Construct the desired URL:
  if (start) {
    if (direction == "next") {
      start = parseInt(start) + parseInt(steps);
    } 
    if (direction == "previous") {// it is just a sign (plus/minus) change.
      start = parseInt(start) - parseInt(steps);
    }
    if (start >= 0) {
      start = String(start);
    } else {
      start = "0";
    }
    url = "{% url 'catalog:index' %}?start=" + start;
  }

  if (stop) {
    if (direction == "next") {
      stop = parseInt(stop) + parseInt(steps);
    }
    if (direction == "previous") {
      stop = parseInt(stop) - parseInt(steps);
    }
    
    if (stop >= 0) {
      stop = String(stop);
    } else {
      stop = steps;
    }
    url = "{% url 'catalog:index' %}?start=" + start + "&stop=" + stop;
  }

  if (!start) {
    url = "{% url 'catalog:index' %}?start=" + steps;
  }

  // point UA to the desired URL:
  document.location.assign(url);

}

/* End of html.helper.js */
