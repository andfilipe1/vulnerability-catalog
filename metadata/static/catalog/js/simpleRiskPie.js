/* Risk level chart: 
 *
 * It uses d3js.org library to draw a simple risk level pie chart.
 * Please, attach it at the Panorama main template.
 */

url = "/catalog/vulnerability/data/json/filter/?field=risk"

/* Create the <svg> box: */
var width = "100";
var height = "50";

var a = d3.select("#riskChart")
          .append("div")
          .attr("id", "divRisk")
          .attr("class", "col");

    a.append("h4")
     .text("Risk level:");

    a.append("br");

//min-x, min-y, width, height
var viewBoxSpecs = "0 0 " + width + " " + height;

var svg = d3.select("#riskChart")
            .append("svg")
            .attr("id", "svgPie")
            .attr("viewBox", viewBoxSpecs) // to become a responsive SVG.
            .attr("xmlns", "http://www.w3.org/2000/svg");

var data; 
d3.json(url, function(d) {
  data = d;
  /* Specify the pie's dimensions. It is a circle, so only radius matter: */ 
  var pieRadius = d3.min([width, height])/4;
  var pieLimits = d3.arc()
              .outerRadius(pieRadius)
              .innerRadius(0); // Set, if you wish a donut-like chart.

  /* Map data values into arc angles to find the pie' slices size: */
  var slices = d3.pie()
               .value(function(d) { return d.vulnerabilities; })
               (data);

  var translation = pieRadius;
  var group = d3.select("#svgPie")
                .append("g")
                .attr("transform", 
                      "translate(" + translation + "," + translation + ")");

  /* Finally, insert the slices into the pie: */
  var chart = group.selectAll("g") //selectAll() or data goes outside <body>.
                   .data(slices)
                   .enter()
                   .append("path")
                   .attr("d", pieLimits)
                   .style("fill", function(d) { 
                                    if (d.data["risk"] == "High") {
                                      return "Crimson";} 
                                    if (d.data["risk"] == "Medium") {
                                      return "LightCoral";} 
                                    if (d.data["risk"] == "Low") {
                                      return "LightSalmon";} 
                                  });
});

/* End of Risk level chart: */
