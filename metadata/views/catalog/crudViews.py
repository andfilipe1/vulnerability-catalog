from django.views.generic.edit import CreateView, UpdateView, DeleteView
from catalog.forms import VulnerabilityForm

from django.contrib.auth.decorators import login_required, permission_required
from django.views.decorators.cache import never_cache
from django.utils.decorators import method_decorator

from .models import Vulnerability


decorators = [login_required(login_url='catalog:login')]

@method_decorator(decorators, name='dispatch')
@method_decorator(permission_required('catalog.add_vulnerability', raise_exception=True), name='dispatch')
class CreateVulnerability(CreateView):
    ### Template to add a vulnerability
    form_class = VulnerabilityForm

    template_name = 'catalog/add.html'
    success_url = '/catalog/vulnerability/data/catalog'

@method_decorator(decorators, name='dispatch')
@method_decorator(permission_required('catalog.change_vulnerability', raise_exception=True), name='dispatch')
class UpdateVulnerability(UpdateView):
    ### Template to add a vulnerability
    model = Vulnerability
    permission_required('catalog.change_vulnerability')

    template_name = 'catalog/update.html'
    fields = '__all__'
    success_url = '/catalog/vulnerability/data/catalog'

@method_decorator(decorators, name='dispatch')
@method_decorator(permission_required('catalog.delete_vulnerability', raise_exception=True), name='dispatch')
class DeleteVulnerability(DeleteView):
    ### Template to add a vulnerability
    model = Vulnerability
    permission_required('catalog.delete_vulnerability')
    template_name = 'catalog/delete.html'
    success_url = '/catalog/vulnerability/data/catalog'

