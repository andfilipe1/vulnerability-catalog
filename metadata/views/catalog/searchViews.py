from django.views.generic import View
from django.core import serializers
from django.http import HttpRequest, HttpResponse

from django.http import HttpResponseForbidden
from django.http import HttpResponseNotFound

from django.db.models import Count

import json

from .models import Vulnerability

class SearchView(View):
    model = Vulnerability
    def get_data(HttpRequest, field=None, countby=None):
        if not HttpRequest.user.is_authenticated:
            return HttpResponseForbidden()

        allowed_fields = ['system', \
                          'owner', \
                          'enviromnent', \
                          'perimeter', \
                          'technology', \
                          'system_type', \
                          'vulnerability', \
                          'category', \
                          'cvss_score', \
                          'identification_date', \
                          'risk', \
                          'remediation_deadline', \
                          'status']

        field = HttpRequest.GET.get('field')

        result = field
        return HttpResponse(result)
