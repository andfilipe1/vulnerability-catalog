from django.views.generic import View
from django.core import serializers
from django.http import HttpRequest, HttpResponse

from django.http import HttpResponseForbidden
from django.http import HttpResponseNotFound

from django.db.models import Q

import json
import shlex

from .models import Vulnerability

class SearchView(View):
    model = Vulnerability

    def get_data(HttpRequest, q=None):
        if not HttpRequest.user.is_authenticated:
            return HttpResponseForbidden()

        search_string = HttpRequest.POST.get('q')
        if not search_string:
            return HttpResponseNotFound("No results found.")

        #### Parsing data to enable complex search filter:
        search_dict = dict()
        word_list = list()
        words = shlex.split(search_string) ## each word in search string.
        for i in words:
            if "=" in i:
                tmp = i.split("=")  
                search_dict[tmp[0]] = tmp[1]
            else:
                word_list.append(i)
   
        return HttpResponse([search_dict, word_list])
 
