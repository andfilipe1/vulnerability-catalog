import platform
import os
import subprocess
from pathlib import Path

global PROJECT_NAME
PROJECT_NAME="base"

def get_environment():
    '''Returns a dictionary with relevant information about OS environment'''
    env = dict()
    env['system'] = platform.system()

    if env['system'] == 'Linux':
        env['system version'] = platform.linux_distribution()
    
    if env['system'] == 'Windows':
        env['system version'] = platform.linux_distribution()

    return(env)

def run():
    env = get_environment()
    target = Path(os.path.join(os.path.curdir, 'venv',))
    if not target.is_dir():
        os.chdir(os.path.join(os.path.curdir, PROJECT_NAME))
        if env['system'] == 'Linux':
            os.system('python3 manage.py runserver')
        if env['system'] == 'Windows':
            subprocess.run('python.exe manage.py runserver')
    else:
        if env['system'] == 'Linux':
            print("It seems that you have a virtual environment. Start it by typing\n\n    source venv/bin/activate\n\n and then run\n\n    cd base && python3 manage.py runserver\n\n")
        if env['system'] == 'Windows':
            subprocess.run('venv\\Scripts\\activate.bat')
            os.chdir(os.path.join(os.path.curdir, PROJECT_NAME))
            subprocess.run('python.exe manage.py runserver')


run()